<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Blog list</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

</head>
<body>
<input type="text" id="key">
<button onclick="search()">Search</button>
<button onclick="showAllBlogs()">Show blogs</button>
<hr>
<div id="edit"></div>
<hr>
<table border="1">
    <tbody id="content">
    </tbody>
    <hr>
</table>
<script>
    let show = document.getElementById("content");

    function showAllBlogs() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/blogs",
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        });
    }

    function display(data) {
        let str = "    <tr>\n" +
            "        <th>ID</th>\n" +
            "        <th>Name</th>\n" +
            "        <th>Author</th>\n" +
            "        <th>Category</th>\n" +
            "        <th>Edit</th>\n" +
            "        <th>Remove</th>\n" +
            "    </tr>";
        console.log(data)
        for (let i = 0; i < data.length; i++) {
            str += "<tr>\n" +
                `<td>${data[i].id}</td>` +
                `<td>${data[i].name}</td>` +
                `<td>${data[i].author}</td>` +
                `<td>${data[i].category.name}</td>` +
                `<td><button onclick='showEditForm(${data[i].id})'>Edit</button></td>` +
                `<td><button onclick='remove(${data[i].id})'>Remove</button></td>` +
                "    </tr>"
        }
        show.innerHTML = str;
    }

    function search() {
        let key = document.getElementById("key").value;
        console.log(key);
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/blogs/search?name=" + key,
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        });
    }

    function update(id) {
        let name = document.getElementById("name").value;
        let author = document.getElementById("author").value;
        let category = document.getElementById("category").value;
        let blog = {
            "name": name,
            "author": author,
            "category": {
                "name": category
            }
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "PUT",
            url: "http://localhost:8080/api/blogs/"+id,
            data: JSON.stringify(blog),
            success: showAllBlogs,
            error: alert("Loi")
        });
    }

    let editContent = document.getElementById("edit");

    function showEditForm(id) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/blogs/" + id,
            success:
                function (data) {
                    let str = "\n" +
                        `Name <input type=\"text\" id=\"name\" value="${data.name}">\n` +
                        `Author <input type=\"text\" id=\"author\" value="${data.author}">\n` +
                        `Category <input type=\"text\" id=\"category\" value="${data.category.name}">` +
                        `<button onclick="update(${data.id})">Update</button>`
                    editContent.innerHTML = str;
                }
        });
    }

</script>
</body>
</html>